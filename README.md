# ShellMind

**Command History Database + AI Copilot**

ShellMind enhances your shell experience by logging all commands to a SQLite database and providing an AI-powered copilot for intelligent command suggestions based on your history.

[![](https://mermaid.ink/img/pako:eNqdV_1u2zYQfxVO_WfD7MQfsR0bW7ckclZjgdPGLootDgJaoi0ilKiSVBwvCLBn2aPtSXYkRUqO065IHEC6433x7sfj6TGIeEyCUbBifBMlWCg0DxcZgr-ZAur760XwURKBLnOSSTQnIqUZZovg5gfUbL5Fk4wqEJFEFfltxNMUZ_Et4-s1zdYHMkGM41iCtDWppY3aWUKiu_D0cRGEWOEllgSRByqV_GURPFnZUgTE0ZRbJUGwIuEp-LOvaPbhgsIjPP1pKd7O8ZIROUK1KDR7ksXkQfMVTYlUOM0bTqSBJJGS8swHWHP6B5HG6xXB8RZczrZSkdSS2u7MqqJJiNYkIwLiiSs7ZaiVBcs3r4apk3qWxi69ooDslmF5K6WMkR8_kKhQRO_dSkHCDEcimiGZEMa8Xilr9N5xfgdKuSARWEqAQkrQ9ZqIqixaxmYY56oQxol9QylROIYSjfSW__37nyqLjlEG7Ugoo7rVmHKMDRd3AIbbmArHKrN-S71WATvNcOqVEi6VpquElvFU4ClyouFT5IxGGgt8pZUZlsqF9BxLoFEv7OyO5rqu8EAlYp_hoFQo4TfJIEgN9sl0Nr6ao8l0flkHWw3lWtDofMJUTcmD1tKvaMUFyoDeK7WJoq5h2Y4ySyGJqM7bY4kZHCmgql26dR3zVZE5H3W47Qt-KIjYogTOHhcWmYZzhhkzMGAMfdYMd7glnGofdd0QeEAnE4ShtICPzIZ8MvlQt4TpZ7QqMhO3N-L9Vd7nW1NcG5sCotqkX9c-AdSk9DRL-ObKkLqmQCADhanLgtTo2FCVIAAiiWC3lMjdGJzVFaaMxN7quSHB6jllCtLuEY6--xm1XjYhCRZR4k3MDKkDs_zlFt2RLZwMcwAuJr-PbZJfNgYBe0shFVUkYKZ2ul5WLjIKpr3-R0OCiXAym0-mZ_Od_FRbg51pBmZ5gpdEwRFjL9tfBNZD09ZiETxz5WvybQ4hJURA8mFrxmD0hZwAxJSs8qsp8HGyXguy1t1ArwMOaSR955pzhdmOd82dFVEE7ehQVxlBE6fcrdj4XbOSz9j_iyIQkPWy6fguICSkkV7T9rh0xzXiRaYqoxWwbROgMmdYX0jlm74EIVeyYM-UzisYl6LV2qzC595aWMJtb-FjBaUvrO3HWXPpK_aSxxdW3P72u2LZVczKb0Sd8UzZHmsbBly7us9Glu3rv9fG0A5ynRgYRO8_hXXycgZ37Ir77FY-TQinBWXxe8HTXMdgKN0Jc8Mx7q_t8HADuyW6DboeadauCkZu0GVGPAJ4xsyIcV16udER_Oiiun5nm_UNKtNdh_Q1pEDq9npjWv6ztlKLtLzvGTuZmL4EbhWHBg0zoEIn7ye1m1fLWHFGcHZZqLzQGzWURl4Op4P4NF-RlN_D4IDFXcw32TP2JoGBTeY48lf9-EEJuMnQCkCgEKNZ7dKv_PmTZGcmhw1ZwCQDqY33L1Qra-PmGVhP3b0ZWVL-okPYHk6rMcEuuCHBQm98j5l1Su6r_qFVYe6KCiF0CXbnr5odmB2m9iZccjM8mCdqooyXA1z9Kix9GYULvr4yp7o28tljbhpzoXiKTV9mWzO-EFPA8NQbKz3tnR5v-IW1rA3e5jANIPiXMOUxAvfokti9OZlfHxFN1yPo_YlSuRwdHpp2Gx2k8HmAaWy-Iw5icn9oyr3kWMSHMVlhcNqkKV6TpkxwTg7kPUxNDZSMUKfVaqBN-cy51MaXvjBSbSEQ80ECOGFs9GbYGo-HrYZUgt-R0ZtO3Gu1-yXZ3NBYJaNu_lDXdqO91T8_Pz8Oz7z-8XLQ7fV29Tu7-nZ0t9rHg7Px-NRrt0kPD-Jv8K4Hytf6L6dKpx4OWq2aen_YPvpqAH5Ue61_13Sdfn94elTT73R6na8GUF2Or43AHXqrH4YnrTD0-v3jTud4-fUalMfytf7d6XT6J72dEvSwJ-v-9S9oBGtB42CkREEaQXlM4Kv7UdtfBCoh-ltHg748JotgkT2BWo6zPzlPnabgxToJRivMJFBFHuuvTIrXAlci0Mph1tdDRDDqd42JYPQYPASj5qBz0D3qDnvd43Zr2O8dHTWCLbC77c7BsNXqdIetfqvb73UGT43gL-O2fdAbHvX7g14PFtv9Qefo6T9jlnE4?type=png)](https://mermaid.live/edit#pako:eNqdV_1u2zYQfxVO_WfD7MQfsR0bW7ckclZjgdPGLootDgJaoi0ilKiSVBwvCLBn2aPtSXYkRUqO065IHEC6433x7sfj6TGIeEyCUbBifBMlWCg0DxcZgr-ZAur760XwURKBLnOSSTQnIqUZZovg5gfUbL5Fk4wqEJFEFfltxNMUZ_Et4-s1zdYHMkGM41iCtDWppY3aWUKiu_D0cRGEWOEllgSRByqV_GURPFnZUgTE0ZRbJUGwIuEp-LOvaPbhgsIjPP1pKd7O8ZIROUK1KDR7ksXkQfMVTYlUOM0bTqSBJJGS8swHWHP6B5HG6xXB8RZczrZSkdSS2u7MqqJJiNYkIwLiiSs7ZaiVBcs3r4apk3qWxi69ooDslmF5K6WMkR8_kKhQRO_dSkHCDEcimiGZEMa8Xilr9N5xfgdKuSARWEqAQkrQ9ZqIqixaxmYY56oQxol9QylROIYSjfSW__37nyqLjlEG7Ugoo7rVmHKMDRd3AIbbmArHKrN-S71WATvNcOqVEi6VpquElvFU4ClyouFT5IxGGgt8pZUZlsqF9BxLoFEv7OyO5rqu8EAlYp_hoFQo4TfJIEgN9sl0Nr6ao8l0flkHWw3lWtDofMJUTcmD1tKvaMUFyoDeK7WJoq5h2Y4ySyGJqM7bY4kZHCmgql26dR3zVZE5H3W47Qt-KIjYogTOHhcWmYZzhhkzMGAMfdYMd7glnGofdd0QeEAnE4ShtICPzIZ8MvlQt4TpZ7QqMhO3N-L9Vd7nW1NcG5sCotqkX9c-AdSk9DRL-ObKkLqmQCADhanLgtTo2FCVIAAiiWC3lMjdGJzVFaaMxN7quSHB6jllCtLuEY6--xm1XjYhCRZR4k3MDKkDs_zlFt2RLZwMcwAuJr-PbZJfNgYBe0shFVUkYKZ2ul5WLjIKpr3-R0OCiXAym0-mZ_Od_FRbg51pBmZ5gpdEwRFjL9tfBNZD09ZiETxz5WvybQ4hJURA8mFrxmD0hZwAxJSs8qsp8HGyXguy1t1ArwMOaSR955pzhdmOd82dFVEE7ehQVxlBE6fcrdj4XbOSz9j_iyIQkPWy6fguICSkkV7T9rh0xzXiRaYqoxWwbROgMmdYX0jlm74EIVeyYM-UzisYl6LV2qzC595aWMJtb-FjBaUvrO3HWXPpK_aSxxdW3P72u2LZVczKb0Sd8UzZHmsbBly7us9Glu3rv9fG0A5ynRgYRO8_hXXycgZ37Ir77FY-TQinBWXxe8HTXMdgKN0Jc8Mx7q_t8HADuyW6DboeadauCkZu0GVGPAJ4xsyIcV16udER_Oiiun5nm_UNKtNdh_Q1pEDq9npjWv6ztlKLtLzvGTuZmL4EbhWHBg0zoEIn7ye1m1fLWHFGcHZZqLzQGzWURl4Op4P4NF-RlN_D4IDFXcw32TP2JoGBTeY48lf9-EEJuMnQCkCgEKNZ7dKv_PmTZGcmhw1ZwCQDqY33L1Qra-PmGVhP3b0ZWVL-okPYHk6rMcEuuCHBQm98j5l1Su6r_qFVYe6KCiF0CXbnr5odmB2m9iZccjM8mCdqooyXA1z9Kix9GYULvr4yp7o28tljbhpzoXiKTV9mWzO-EFPA8NQbKz3tnR5v-IW1rA3e5jANIPiXMOUxAvfokti9OZlfHxFN1yPo_YlSuRwdHpp2Gx2k8HmAaWy-Iw5icn9oyr3kWMSHMVlhcNqkKV6TpkxwTg7kPUxNDZSMUKfVaqBN-cy51MaXvjBSbSEQ80ECOGFs9GbYGo-HrYZUgt-R0ZtO3Gu1-yXZ3NBYJaNu_lDXdqO91T8_Pz8Oz7z-8XLQ7fV29Tu7-nZ0t9rHg7Px-NRrt0kPD-Jv8K4Hytf6L6dKpx4OWq2aen_YPvpqAH5Ue61_13Sdfn94elTT73R6na8GUF2Or43AHXqrH4YnrTD0-v3jTud4-fUalMfytf7d6XT6J72dEvSwJ-v-9S9oBGtB42CkREEaQXlM4Kv7UdtfBCoh-ltHg748JotgkT2BWo6zPzlPnabgxToJRivMJFBFHuuvTIrXAlci0Mph1tdDRDDqd42JYPQYPASj5qBz0D3qDnvd43Zr2O8dHTWCLbC77c7BsNXqdIetfqvb73UGT43gL-O2fdAbHvX7g14PFtv9Qefo6T9jlnE4)


## Features

- **Persistent Command History Database**: Store all shell commands in a searchable SQLite database
- **Context-Aware Logging**: Track commands with timestamps, working directory, exit codes, and session info
- **Powerful Query Interface**: Search and analyze your command history with flexible queries
- **AI Copilot (`aiq`)**: Get intelligent command suggestions based on your history and context
- **Cross-Session History**: Access commands across different shell sessions
- **Directory-Aware**: View commands specific to directories or projects

## Installation

> **⚠️ WARNING: This tool only works with Zsh shell. It will not work with Bash or other shells.**

### Prerequisites

- **Zsh shell** - Required (does not work with Bash)
- `sqlite3` - for command history database
- `aichat` - for AI copilot feature (optional but recommended)
  - Install from: https://github.com/sigoden/aichat
  - **Tip**: Works great with cheap models like Gemini Flash Lite. For best results, run commands manually first to build context history rather than relying solely on AI-generated commands.

### Quick Install

```bash
git clone https://github.com/0xrushi/shellmind.git
cd shellmind
./install.sh
```

Then restart your shell or run:
```bash
source ~/.zshrc
```

### Uninstall

```bash
cd shellmind
./uninstall.sh
```

The uninstaller removes the installed scripts and ShellMind block in your `~/.zshrc`. It will ask before deleting your command history database.

## Usage

### Command History Queries

Query your command history with various filters:

```bash
# Show recent commands
query_commands.sh recent

# Show last 50 commands
query_commands.sh recent 50

# Show failed commands
query_commands.sh failed

# Search for specific commands
query_commands.sh search docker

# Show commands from current directory
query_commands.sh dir

# Show commands from specific directory
query_commands.sh dir /path/to/project

# List all directories with command counts
query_commands.sh dirs

# Show unique successful commands (current dir)
query_commands.sh unique

# Show statistics
query_commands.sh stats

# Show today's commands
query_commands.sh today

# Export history to CSV
query_commands.sh export
```

### AI Copilot (`aiq`)

Ask natural language questions to get command suggestions:

```bash
# Get command suggestions based on your question
aiq find all pdf files

# The AI will suggest a command based on:
# - Your recent command history
# - Current working directory
# - Operating system context
```

The `aiq` function will:
1. Analyze your recent command history from the database
2. Consider your current context (PWD, OS)
3. Generate an appropriate shell command
4. Ask for confirmation before executing

## Architecture

```
shellmind/
├── README.md                          # This file
├── LICENSE                            # MIT License
├── install.sh                         # Installation script
├── bin/
│   ├── setup_command_logging.sh      # Initialize DB and logging hooks
│   └── query_commands.sh             # Query interface for command history
├── zsh/
│   └── aiq.zsh                       # AI copilot function
└── examples/
    └── example_queries.md            # Usage examples
```

### Database Schema

```sql
CREATE TABLE command_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT NOT NULL,
    username TEXT,
    hostname TEXT,
    working_dir TEXT,
    command TEXT NOT NULL,
    exit_code INTEGER,
    session_id TEXT
);
```

## Configuration

Environment variables:

- `COMMAND_LOG_DB`: Path to SQLite database (default: `~/.command_history.db`)
- `HCOUNT`: Number of history commands to show to AI (default: 10)
- `AIQ_MAX_CTX`: Max context size for AI queries (default: 2000)

## How It Works

1. **Command Logging**: The `precmd` hook in zsh captures every command after execution
2. **Database Storage**: Commands are stored with metadata in SQLite
3. **Query Interface**: `query_commands.sh` provides various query modes
4. **AI Integration**: `aiq` sends context + history to `aichat` for intelligent suggestions

## Examples

See [examples/example_queries.md](examples/example_queries.md) for detailed usage examples.

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Contributing

Contributions welcome! Please open an issue or pull request.

## Credits

Built with:
- [SQLite](https://www.sqlite.org/) - Command history database
- [aichat](https://github.com/sigoden/aichat) - AI CLI interface
